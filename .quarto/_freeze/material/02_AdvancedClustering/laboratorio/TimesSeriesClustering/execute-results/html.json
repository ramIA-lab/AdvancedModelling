{
  "hash": "89c3c3ad906a733ce67d7c5cb2b68c0d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Times Series Clustering\"\nauthor: Dante Conti, Sergi Ramirez, (c) IDEAI\ndate: \"2025-01-11\"\ndate-modified: \"2025-01-11\"\ntoc: true\n# language: es\nnumber-sections: true\nformat: \n  html: \n    theme:\n      light: cerulean\n      dark: darkly\neditor: visual\n#execute: \n#  freeze: auto\n---\n\n\n\n# Descripció del problema\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Carreguem les llibreries necessaries\nlibrary(dtw)\nlibrary(tidyverse)\nlibrary(proxy)\nlibrary(dendextend)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://www.ine.es/jaxiT3/files/t/es/csv_bdsc/2013.csv?nocab=1\"\n\n# Carreguem la base de dades\ndad <- read.csv2(url)\ndad[, 2] <- NULL\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transformem la bbdd a la taula necessaria\ndad[, \"Total\"] <- as.numeric(dad[, \"Total\"])\ndad[, \"Zonas.Turísticas\"] <- gsub(\":\", \"_\", dad[, \"Zonas.Turísticas\"])\ndad[, \"Zonas.Turísticas\"] <- gsub(\" \", \"\", dad[, \"Zonas.Turísticas\"])\ndatos <- reshape2::dcast(dad, Zonas.Turísticas ~ Periodo, fun.aggregate = sum, na.rm = TRUE)\nrownames(datos) <- datos[, \"Zonas.Turísticas\"]\ndatos[, \"Zonas.Turísticas\"] <- NULL\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculamos la distancia DTW\ndistMatrix <- proxy::dist(datos, method = \"DTW\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generamos el clustering\nhcc <- hclust(distMatrix, method = \"ward.D2\")\nplot(hcc, hang = -1, cex = 0.6) # Put the labels at the same height: hang = -1\n```\n\n::: {.cell-output-display}\n![](TimesSeriesClustering_files/figure-html/crea-dendograma-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Realizamos el corte en 4 clases\nk <- 4\nclusters <- cutree(hcc, k = k)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos %>% \n  proxy::dist(method = \"DTW\") %>% \n  hclust(method = \"ward.D2\") %>% \n  as.dendrogram() -> dend\n\ndend %>% set(\"branches_k_color\", k = k) %>% plot(hang = -1)\n```\n\n::: {.cell-output-display}\n![](TimesSeriesClustering_files/figure-html/visualizacion-colores-1.png){width=672}\n:::\n:::\n\n\n## Otras formas de hacerlo más automático\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dtwclust)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Partitional\npc <- tsclust(datos[, -1], type = \"partitional\", k = 20, \n              distance = \"dtw_basic\", centroid = \"pam\", \n              seed = 3247L, trace = TRUE,\n              args = tsclust_args(dist = list(window.size = 20)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPrecomputing distance matrix...\n\nIteration 1: Changes / Distsum = 47 / 1175955\nIteration 2: Changes / Distsum =   6 / 888595\nIteration 3: Changes / Distsum =   0 / 888595\n\n\tElapsed time is 0.13 seconds.\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(pc)\n```\n\n::: {.cell-output-display}\n![](TimesSeriesClustering_files/figure-html/particional-automatica-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Hierarchical\nhc <- tsclust(CharTraj, type = \"hierarchical\", k = 20L, \n              distance = \"dtw_basic\", trace = TRUE,\n              control = hierarchical_control(method = \"ward.D2\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCalculating distance matrix...\nPerforming hierarchical clustering...\nExtracting centroids...\n\n\tElapsed time is 0.17 seconds.\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(hc)\n```\n\n::: {.cell-output-display}\n![](TimesSeriesClustering_files/figure-html/jerarquico-automatica-1.png){width=672}\n:::\n:::\n\n\n\n## Bibliografia\n\n- Beautiful dendrogram visualizations in r: 5+ must known methods - unsupervised machine learning - easy guides - wiki - sthda. (s. f.). Recuperado 11 de enero de 2025, de [https://www.sthda.com/english/wiki/beautiful-dendrogram-visualizations-in-r-5-must-known-methods-unsupervised-machine-learning?title=beautiful-dendrogram-visualizations-in-r-5-must-known-methods-unsupervised-machine-learning](https://www.sthda.com/english/wiki/beautiful-dendrogram-visualizations-in-r-5-must-known-methods-unsupervised-machine-learning?title=beautiful-dendrogram-visualizations-in-r-5-must-known-methods-unsupervised-machine-learning)\n\n- Dendrograms. (s. f.). Recuperado 11 de enero de 2025, de [https://plotly.com/ggplot2/dendrogram/](https://plotly.com/ggplot2/dendrogram/)\n\n- Introduction. (s. f.). [Software]. Recuperado 11 de enero de 2025, de [https://cran.r-project.org/web/packages/dendextend/vignettes/dendextend.html](https://cran.r-project.org/web/packages/dendextend/vignettes/dendextend.html)\n\n- RPubs—Clustering de series temporales a traves de metodos no parametricos. (s. f.). Recuperado 11 de enero de 2025, de [https://rpubs.com/Edison-D/615477](https://rpubs.com/Edison-D/615477)\n\n- RPubs—Dinamyc time warping. (s. f.). Recuperado 11 de enero de 2025, de [https://rpubs.com/sebas_Alf/684217](https://rpubs.com/sebas_Alf/684217)\n\n- Sardá, A. (2024). Asardaes/dtwclust [R]. [https://github.com/asardaes/dtwclust](https://github.com/asardaes/dtwclust) (Obra original publicada en 2015)\n",
    "supporting": [
      "TimesSeriesClustering_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}