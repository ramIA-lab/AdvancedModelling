{
  "hash": "d50ffdb228efd277219b457358b79312",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Anàlisis factorial per a Dades mixtes (FAMD)\"\nauthor: Dante Conti, Sergi Ramirez, (c) IDEAI\ndate: \"2025-04-21\"\ndate-modified: \"2025-04-21\"\ntoc: true\n# language: es\nnumber-sections: true\nformat: \n  html: \n    theme:\n      light: cerulean\n      dark: darkly\neditor: visual\n#execute: \n#  freeze: auto\n---\n\n\n\n# Introducción\n\nEl Análisis Factorial de Datos Mixtos (FAMD) es una potente técnica estadística que se utiliza para analizar conjuntos de datos que contienen variables numéricas y categóricas. Amplía el análisis factorial tradicional para gestionar tipos de datos mixtos, proporcionando una comprensión integral de la estructura subyacente de conjuntos de datos complejos.\n\n\n\n```{mermaid}\nflowchart TD\n    cat?(¿BBDD Categorica?) --> |\"✅\"| num_too?(¿Contiene numéricas?)\n    num_too? --> |\"✅\"| FAMD\n    num_too? --> |\"❌\"| multiple_cat?(¿Más de dos columnas?)\n    multiple_cat? --> |\"✅\"| MCA\n    multiple_cat? --> |\"❌\"| CA\n    cat? --> |\"❌\"| groups?(¿Columnas agrupadas?)\n    groups? --> |\"✅\"| MFA\n    groups? --> |\"❌\"| shapes?(Analysing shapes?)\n    shapes? --> |\"✅\"| GPA\n    shapes? --> |\"❌\"| PCA\n```\n\n\n\nPara poder realizar los métodos, necesitaremos importar las siguientes librerias:\n\n::: panel-tabset\n## R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Import libraries\nlibrary(FactoMineR)\nlibrary(factoextra)\n```\n:::\n\n\n\n## Python\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport prince\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib.cm as cm\nimport seaborn as sns\nfrom matplotlib.colors import LinearSegmentedColormap, Normalize\n```\n:::\n\n\n:::\n\n# Planteamiento del problema\n\nDescripció de la columna:\n\n-   **Gender:** El gènere del client: Home (1), Femení (0).\n\n-   **SeniorCitizen:** Indica si el client té 65 anys o més: No (0), Sí (1).\n\n-   **Partner:** El contracte de servei és revenut pel soci: No (0), Sí (1).\n\n-   **Dependents:** Indica si el client viu amb algun dependent: No (0), Sí (1).\n\n-   **Tenure:** Indica l'import total de mesos que el client ha estat amb l'empresa.\n\n-   **PhoneService:** Indica si el client es subscriu al servei de telèfon de casa amb l'empresa: No (0), Sí (1).\n\n-   **MultipleLines:** Indica si el client es subscriu a diverses línies telefòniques amb l'empresa: No (0), Sí (1).\n\n-   **InternetService:** Indica si el client es subscriu al servei d'Internet amb l'empresa: No (0), DSL (1), Fibra òptica (2).\n\n-   **OnlineSecurity:** Indica si el client es subscriu a un servei addicional de seguretat en línia prestat per l'empresa: No (0), Sí (1), NA (2).\n\n-   **OnlineBackup:** Indica si el client es subscriu a un servei de backup online addicional proporcionat per l'empresa: No (0), Sí (1), NA (2).\n\n-   **DeviceProtection:** Indica si el client es subscriu a un pla addicional de protecció de dispositius per als seus equips d'Internet proporcionats per l'empresa: No (0), Sí (1), NA (2).\n\n-   **TechSupport:** Indica si el client es subscriu a un pla de suport tècnic addicional de l'empresa amb temps d'espera reduïts: No (0), Sí (1), NA (2).\n\n-   **StreamingTV:** Indica si el client utilitza el seu servei d'Internet per transmetre la programació de televisió d'un proveïdor de tercers: No (0), Sí (1), NA (2). L'empresa no cobra cap càrrec addicional per aquest servei.\n\n-   **StreamingMovies:** Indica si el client utilitza el seu servei d'Internet per transmetre pel·lícules d'un proveïdor de tercers: No (0), Sí (1), NA (2). L'empresa no cobra cap càrrec addicional per aquest servei.\n\n-   **Contract:** Indica el tipus de contracte actual del client: Mes a mes (0), Un any (1), Dos anys (2).\n\n-   **PaperlessBilling:** Indica si el client ha triat facturació sense paper: No (0), Sí (1).\n\n-   **PaymentMethod:** Indica com el client paga la seva factura: transferència bancària - automàtica (0), targeta de crèdit - automàtica (1), xec electrònic (2), xec per correu (3).\n\n-   **MonthlyCharges:** Indica el total de la quota mensual actual del client per a tots els seus serveis de l'empresa.\n\n-   **TotalCharges:** Indica el total de càrrecs del client.\n\n-   **Churn:** Indica si el client es talla o no: No (0), Sí (1).\n\n::: panel-tabset\n## R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Import data\ndf <- read.csv('https://raw.githubusercontent.com/nchelaru/data-prep/refs/heads/master/telco_cleaned_renamed.csv')\n\n## Preview data\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Gender    SeniorCitizen    Partner    Dependents Tenure    PhoneService\n1 Female No SeniorCitizen    Partner No Dependents      1 No PhoneService\n2   Male No SeniorCitizen No Partner No Dependents     34    PhoneService\n3   Male No SeniorCitizen No Partner No Dependents      2    PhoneService\n4   Male No SeniorCitizen No Partner No Dependents     45 No PhoneService\n5 Female No SeniorCitizen No Partner No Dependents      2    PhoneService\n6 Female No SeniorCitizen No Partner No Dependents      8    PhoneService\n     MultipleLines InternetService    OnlineSecurity    OnlineBackup\n1 No MultipleLines             DSL No OnlineSecurity    OnlineBackup\n2 No MultipleLines             DSL    OnlineSecurity No OnlineBackup\n3 No MultipleLines             DSL    OnlineSecurity    OnlineBackup\n4 No MultipleLines             DSL    OnlineSecurity No OnlineBackup\n5 No MultipleLines     Fiber optic No OnlineSecurity No OnlineBackup\n6    MultipleLines     Fiber optic No OnlineSecurity No OnlineBackup\n     DeviceProtection    TechSupport    StreamingTV    StreamingMovies\n1 No DeviceProtection No TechSupport No StreamingTV No StreamingMovies\n2    DeviceProtection No TechSupport No StreamingTV No StreamingMovies\n3 No DeviceProtection No TechSupport No StreamingTV No StreamingMovies\n4    DeviceProtection    TechSupport No StreamingTV No StreamingMovies\n5 No DeviceProtection No TechSupport No StreamingTV No StreamingMovies\n6    DeviceProtection No TechSupport    StreamingTV    StreamingMovies\n        Contract    PaperlessBilling             PaymentMethod MonthlyCharges\n1 Month-to-month    PaperlessBilling          Electronic check          29.85\n2       One year No PaperlessBilling              Mailed check          56.95\n3 Month-to-month    PaperlessBilling              Mailed check          53.85\n4       One year No PaperlessBilling Bank transfer (automatic)          42.30\n5 Month-to-month    PaperlessBilling          Electronic check          70.70\n6 Month-to-month    PaperlessBilling          Electronic check          99.65\n  TotalCharges    Churn\n1        29.85 No Churn\n2      1889.50 No Churn\n3       108.15    Churn\n4      1840.75 No Churn\n5       151.65    Churn\n6       820.50    Churn\n```\n\n\n:::\n:::\n\n\n\nVisualizamos la estructura de los datos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t7032 obs. of  20 variables:\n $ Gender          : chr  \"Female\" \"Male\" \"Male\" \"Male\" ...\n $ SeniorCitizen   : chr  \"No SeniorCitizen\" \"No SeniorCitizen\" \"No SeniorCitizen\" \"No SeniorCitizen\" ...\n $ Partner         : chr  \"Partner\" \"No Partner\" \"No Partner\" \"No Partner\" ...\n $ Dependents      : chr  \"No Dependents\" \"No Dependents\" \"No Dependents\" \"No Dependents\" ...\n $ Tenure          : int  1 34 2 45 2 8 22 10 28 62 ...\n $ PhoneService    : chr  \"No PhoneService\" \"PhoneService\" \"PhoneService\" \"No PhoneService\" ...\n $ MultipleLines   : chr  \"No MultipleLines\" \"No MultipleLines\" \"No MultipleLines\" \"No MultipleLines\" ...\n $ InternetService : chr  \"DSL\" \"DSL\" \"DSL\" \"DSL\" ...\n $ OnlineSecurity  : chr  \"No OnlineSecurity\" \"OnlineSecurity\" \"OnlineSecurity\" \"OnlineSecurity\" ...\n $ OnlineBackup    : chr  \"OnlineBackup\" \"No OnlineBackup\" \"OnlineBackup\" \"No OnlineBackup\" ...\n $ DeviceProtection: chr  \"No DeviceProtection\" \"DeviceProtection\" \"No DeviceProtection\" \"DeviceProtection\" ...\n $ TechSupport     : chr  \"No TechSupport\" \"No TechSupport\" \"No TechSupport\" \"TechSupport\" ...\n $ StreamingTV     : chr  \"No StreamingTV\" \"No StreamingTV\" \"No StreamingTV\" \"No StreamingTV\" ...\n $ StreamingMovies : chr  \"No StreamingMovies\" \"No StreamingMovies\" \"No StreamingMovies\" \"No StreamingMovies\" ...\n $ Contract        : chr  \"Month-to-month\" \"One year\" \"Month-to-month\" \"One year\" ...\n $ PaperlessBilling: chr  \"PaperlessBilling\" \"No PaperlessBilling\" \"PaperlessBilling\" \"No PaperlessBilling\" ...\n $ PaymentMethod   : chr  \"Electronic check\" \"Mailed check\" \"Mailed check\" \"Bank transfer (automatic)\" ...\n $ MonthlyCharges  : num  29.9 57 53.9 42.3 70.7 ...\n $ TotalCharges    : num  29.9 1889.5 108.2 1840.8 151.7 ...\n $ Churn           : chr  \"No Churn\" \"No Churn\" \"Churn\" \"No Churn\" ...\n```\n\n\n:::\n:::\n\n\n\n## Python\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\npydf = pd.read_csv('https://raw.githubusercontent.com/nchelaru/data-prep/refs/heads/master/telco_cleaned_renamed.csv')\n```\n:::\n\n\n\nVisualizamos la estructura de los datos:\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\npydf.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 7032 entries, 0 to 7031\nData columns (total 20 columns):\n #   Column            Non-Null Count  Dtype  \n---  ------            --------------  -----  \n 0   Gender            7032 non-null   object \n 1   SeniorCitizen     7032 non-null   object \n 2   Partner           7032 non-null   object \n 3   Dependents        7032 non-null   object \n 4   Tenure            7032 non-null   int64  \n 5   PhoneService      7032 non-null   object \n 6   MultipleLines     7032 non-null   object \n 7   InternetService   7032 non-null   object \n 8   OnlineSecurity    7032 non-null   object \n 9   OnlineBackup      7032 non-null   object \n 10  DeviceProtection  7032 non-null   object \n 11  TechSupport       7032 non-null   object \n 12  StreamingTV       7032 non-null   object \n 13  StreamingMovies   7032 non-null   object \n 14  Contract          7032 non-null   object \n 15  PaperlessBilling  7032 non-null   object \n 16  PaymentMethod     7032 non-null   object \n 17  MonthlyCharges    7032 non-null   float64\n 18  TotalCharges      7032 non-null   float64\n 19  Churn             7032 non-null   object \ndtypes: float64(2), int64(1), object(17)\nmemory usage: 1.1+ MB\n```\n\n\n:::\n:::\n\n\n:::\n\nLos datos contienen 20 columnas divididas en: - **Numéricas**: `Tenure`, `MonthlyCharges` y `TotalCharges` - **Categóricas**: `Gender`, `SeniorCitizen`, `Partner`, `Dependents`, `PhoneService`, `MultipleLines`, `InternetService`, `OnlineSecurity`, `OnlineBackup`, `DeviceProtection`, `TechSupport`, `StreamingTV`, `StreamingMovies`, `Contract`, `PaperlessBilling`, `PaymentMethod` y `Churn` (variable respuesta)\n\n::: {.callout-tip title=\"Consejo\"}\nEl objetivo de este estudio es poder estudiar las relaciones y asociaciones que existen en los clientes de la empresa Telecom.\n:::\n\n## Entrenamiento\n\n::: panel-tabset\n## R\n\nLa función `FAMD()` del paquete `FactoMineR`se puede utilizar para calcular los planos factoriales. La descripción de la función es la siguiente:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFAMD (base, ncp = 5, sup.var = NULL, ind.sup = NULL, graph = TRUE)\n```\n:::\n\n\n\n-   `base`: Un `data.frame` con n filas (individuos) y p columnas (variables).\n\n-   `ncp`: El número de dimensiones que se mantienen en los resultados *(por defecto 5)*\n\n-   `sup.var`: Un vector que indica los índices de las variables suplementarias.\n\n-   `ind.sup`: Un vector que indica los índices de los individuos suplementarios.\n\n-   `graph`: Un valor lógico. Si es `VERDADERO`, se muestra un gráfico.\n\nA continuación, vamos a calcular el FAMD de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## FAMD\nres.famd <- FAMD(df, sup.var = 20, graph = FALSE, ncp = 25)\n```\n:::\n\n\n\nLa salida que obtenemos con la función `FAMD()` es una lista que incluye:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(res.famd)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n*The results are available in the following objects:\n\n  name          description                             \n1 \"$eig\"        \"eigenvalues and inertia\"               \n2 \"$var\"        \"Results for the variables\"             \n3 \"$ind\"        \"results for the individuals\"           \n4 \"$quali.var\"  \"Results for the qualitative variables\" \n5 \"$quanti.var\" \"Results for the quantitative variables\"\n```\n\n\n:::\n:::\n\n\n\n## Python\n\nLa función `prince.FAMD()` del paquete `prince`se puede utilizar para calcular los planos factoriales. La descripción de la función es la siguiente:\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfamd = prince.FAMD(n_components = 2, n_iter = 3, copy = True, check_input = True, random_state = 42, engine = \"sklearn\", handle_unknown = \"error\")\n```\n:::\n\n\n\n-   `n_components`: El número de dimensiones que se mantienen en los resultados *(por defecto 2)*\n\n-   `n_iter`: El número de iteraciones de las cuales ha de realizar el FAMD *(por defecto 3)*\n\n-   `copy`: Indica si queremos realizar una copia o por el contrario de la base de datos\n\n-   `check_input`: Valida las variables de entrada\n\n-   `random_state`: Asigna una semilla para los cálculos\n\nA continuación, vamos a calcular el FAMD de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfamdPy = prince.FAMD(n_components=10, random_state=42)\nfamdPy = famdPy.fit(pydf)\n```\n:::\n\n\n:::\n\n## Visualización e interpretación\n\nUtilizaremos las siguientes funciones del paquete `factoextra` para poder obtener las interpretaciones correspondientes:\n\n-   `get_eigenvalue(res.famd)`: Extraer los valores propios/varianzas retenidas por cada dimensión (eje).\n\n-   `fviz_eig(res.famd)`: Visualizar los valores propios/varianzas.\n\n-   `get_famd_ind(res.famd)`: Extraer los resultados para individuos.\n\n-   `get_famd_var(res.famd)`: Extraer los resultados de las variables cuantitativas y cualitativas.\n\n-   `fviz_famd_ind(res.famd)` y `fviz_famd_var(res.famd)`: Visualizar los resultados para individuos y variables, respectivamente.\n\n::: {.callout-tip title=\"Aviso\"}\nRecordad que, para la interpretación de FAMD se ha de realizar lo mismo hecho en clases anteriores en métodos como el ACP, ACS y ACM.\n:::\n\n## Eigenvalues y Eigenvectors\n\n::: panel-tabset\n## R\n\nLa proporción de varianzas retenidas (*eigenvalues*) por las diferentes dimensiones (ejes) se puede extraer utilizando la función `get_eigenvalue()` del paquete `factoextra` de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neig.val <- get_eigenvalue(res.famd)\nhead(eig.val)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1   5.257621        22.859222                    22.85922\nDim.2   2.855902        12.416963                    35.27619\nDim.3   1.860948         8.091076                    43.36726\nDim.4   1.164287         5.062115                    48.42938\nDim.5   1.049924         4.564885                    52.99426\nDim.6   1.015145         4.413675                    57.40794\n```\n\n\n:::\n:::\n\n\n\nLa función `fviz_eig()` o `fviz_screeplot()` del paquete `factoextra` se puede utilizar para dibujar el diagrama de codo (los porcentajes de inercia explicados por cada dimensión de FAMD):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_screeplot(res.famd)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/screePlot-R-1.png){width=672}\n:::\n:::\n\n\n\n## Python\n\nLa proporción de varianzas retenidas (*eigenvalues*) por las diferentes dimensiones (ejes) se puede extraer utilizando el método `.eigenvalues_` de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\neigenvalues = famdPy.eigenvalues_\nfamdPy.eigenvalues_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          eigenvalue % of variance % of variance (cumulative)\ncomponent                                                    \n0             36.181         4.36%                      4.36%\n1             26.517         3.19%                      7.55%\n2             16.198         1.95%                      9.51%\n3             11.046         1.33%                     10.84%\n4             10.134         1.22%                     12.06%\n5              9.378         1.13%                     13.19%\n6              9.195         1.11%                     14.30%\n7              9.107         1.10%                     15.39%\n8              9.077         1.09%                     16.49%\n9              9.066         1.09%                     17.58%\n```\n\n\n:::\n:::\n\n\n\nLa función `fviz_eig()` o `fviz_screeplot()` del paquete `factoextra` se puede utilizar para dibujar el diagrama de codo (los porcentajes de inercia explicados por cada dimensión de FAMD):\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# Hacer el scree plot\nplt.figure(figsize=(8, 5))\nplt.plot(range(1, len(eigenvalues) + 1), eigenvalues, marker='o')\nplt.title('Scree Plot - FAMD')\nplt.xlabel('Componentes')\nplt.ylabel('Valor propio (Eigenvalue)')\nplt.xticks(range(1, len(eigenvalues) + 1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n([<matplotlib.axis.XTick object at 0x0000024D1690F7D0>, <matplotlib.axis.XTick object at 0x0000024D1690DE50>, <matplotlib.axis.XTick object at 0x0000024D168CBE90>, <matplotlib.axis.XTick object at 0x0000024D1690D7C0>, <matplotlib.axis.XTick object at 0x0000024D1683EA50>, <matplotlib.axis.XTick object at 0x0000024D168242F0>, <matplotlib.axis.XTick object at 0x0000024D16824D10>, <matplotlib.axis.XTick object at 0x0000024D16824B60>, <matplotlib.axis.XTick object at 0x0000024D168746E0>, <matplotlib.axis.XTick object at 0x0000024D16874F50>], [Text(1, 0, '1'), Text(2, 0, '2'), Text(3, 0, '3'), Text(4, 0, '4'), Text(5, 0, '5'), Text(6, 0, '6'), Text(7, 0, '7'), Text(8, 0, '8'), Text(9, 0, '9'), Text(10, 0, '10')])\n```\n\n\n:::\n\n```{.python .cell-code}\nplt.grid(True)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/screePlot-python-1.png){width=768}\n:::\n:::\n\n\n:::\n\n## Variables\n\n### Todas las variables\n\n::: panel-tabset\n## R\n\nLa función `get_mfa_var()` del paquete `factoextra` se utiliza para extraer los resultados de las variables. Por defecto, esta función devuelve una lista con las coordenadas, el coseno$^2$ y la contribución de todas las variables:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(var <- get_famd_var(res.famd))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFAMD results for variables \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n\n\n:::\n:::\n\n\n\n#### Coordenadas de las componentes\n\nSe puede acceder a los diferentes componentes de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(var$coord[, 1:4])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Dim.1        Dim.2        Dim.3        Dim.4\nTenure         0.4206809111 0.2864370404 5.868863e-02 0.0218736221\nMonthlyCharges 0.7115470075 0.2017404911 2.527110e-03 0.0009313836\nTotalCharges   0.7986771845 0.0407946811 2.999847e-02 0.0137505310\nGender         0.0001947487 0.0001642962 3.424638e-06 0.0015453361\nSeniorCitizen  0.0304048842 0.1378319021 5.802770e-03 0.0057238890\nPartner        0.0969690101 0.1609366512 6.777893e-02 0.3774002728\n```\n\n\n:::\n:::\n\n\n\n#### Coseno$^2$\n\nA continuación se muestra el coseno$^2$ que representa la calidad de la representación en el mapa factorial.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(var$cos2[, 1:4])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Dim.1        Dim.2        Dim.3        Dim.4\nTenure         1.769724e-01 8.204618e-02 3.444355e-03 4.784553e-04\nMonthlyCharges 5.062991e-01 4.069923e-02 6.386284e-06 8.674754e-07\nTotalCharges   6.378852e-01 1.664206e-03 8.999080e-04 1.890771e-04\nGender         3.792705e-08 2.699325e-08 1.172814e-11 2.388064e-06\nSeniorCitizen  9.244570e-04 1.899763e-02 3.367214e-05 3.276290e-05\nPartner        9.402989e-03 2.590061e-02 4.593984e-03 1.424310e-01\n```\n\n\n:::\n:::\n\n\n\n#### Contribuciones\n\nEn el siguiente apartado, podemos visualizar la contribución de cada una de las varaibles a las dimensiones.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(var$contrib[, 1:4])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                      Dim.1        Dim.2        Dim.3       Dim.4\nTenure          8.001354821 10.029653733 3.1536958900  1.87871471\nMonthlyCharges 13.533630663  7.063986094 0.1357969462  0.07999608\nTotalCharges   15.190847437  1.428434412 1.6119995933  1.18102638\nGender          0.003704122  0.005752867 0.0001840266  0.13272816\nSeniorCitizen   0.578301180  4.826213291 0.3118180199  0.49162203\nPartner         1.844351468  5.635230981 3.6421732973 32.41472495\n```\n\n\n:::\n:::\n\n\n\nLa siguiente figura muestra la correlación entre las variables, tanto cuantitativas como cualitativas, y las dimensiones principales, así como la contribución de las variables a las dimensiones 1 y 2. Se utilizan las siguientes funciones del paquete `factoextra`:\n\n-   `fviz_famd_var()`: para representar gráficamente variables cuantitativas y cualitativas\n\n-   `fviz_contrib()`: para visualizar la contribución de las variables a las dimensiones principales\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/graficoVariables-R-1.png){width=672}\n:::\n:::\n\n\n\nA continuación vamos a visualizar las contribuciones de las variables en la primera dimensión.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Contribution to the first dimension\nfviz_contrib(res.famd, \"var\", axes = 1)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/contribuciones1aDim-R-1.png){width=672}\n:::\n:::\n\n\n\nSeguidamente podemos ver las contribuciones de las variables en la 2a dimensión.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Contribution to the second dimension\nfviz_contrib(res.famd, \"var\", axes = 2)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/contribuciones2aDim-R-1.png){width=672}\n:::\n:::\n\n\n\nLa línea discontinua roja en el gráfico anterior indica el valor promedio esperado, si las contribuciones fueran uniformes.\n\nDe los gráficos anteriormente expuestos se puede observar que:\n\n-   Las variables más contribuyentes a la primera dimensión són:\n\n    -   ...\n\n-   Las variables que más contribuyen a la segunda dimensión son:\n\n    -   ...\n\n## Python\n\n#### Coordenadas de las componentes\n\nSe puede acceder a los diferentes componentes de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n## famd.row_coordinates(pydf)  ## Individuos\nfamdPy.column_coordinates_\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncomponent                0         1  ...         8             9\nvariable                              ...                        \nMonthlyCharges    0.516084  0.326985  ...  0.000024  2.719971e-04\nTotalCharges      0.758263  0.001235  ...  0.001354  1.399417e-06\nChurn             0.031624  0.389555  ...  0.001300  1.998385e-03\nContract          0.204277  0.430340  ...  0.003679  9.335352e-04\nDependents        0.014209  0.206706  ...  0.000808  1.045339e-06\nDeviceProtection  0.426754  0.002936  ...  0.006802  1.348613e-07\nGender            0.000248  0.000380  ...  0.006765  7.022369e-03\nInternetService   0.292035  0.506334  ...  0.005546  1.554956e-03\nMultipleLines     0.206875  0.054604  ...  0.002214  4.321594e-04\nOnlineBackup      0.349894  0.002057  ...  0.001307  1.451828e-03\nOnlineSecurity    0.272749  0.039203  ...  0.010315  1.100983e-03\nPaperlessBilling  0.051292  0.241663  ...  0.001531  2.319590e-02\nPartner           0.143598  0.096932  ...  0.000460  7.417890e-04\nPaymentMethod     0.204439  0.381225  ...  0.020124  1.076496e-03\nPhoneService      0.001444  0.012175  ...  0.000041  1.245809e-05\nSeniorCitizen     0.012635  0.167889  ...  0.000537  4.012970e-03\nStreamingMovies   0.406131  0.088201  ...  0.000606  3.132390e-05\nStreamingTV       0.399842  0.090072  ...  0.003217  1.702668e-03\nTechSupport       0.335530  0.027956  ...  0.000144  5.169755e-06\nTenure            0.525252  0.173087  ...  0.945035  9.635537e-01\n\n[20 rows x 10 columns]\n```\n\n\n:::\n:::\n\n\n\n#### Coseno$^2$\n\nA continuación se muestra el coseno$^2$ que representa la calidad de la representación en el mapa factorial.\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfamdPy.column_coordinates_ ** 2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncomponent                    0             1  ...             8             9\nvariable                                      ...                            \nMonthlyCharges    2.663429e-01  1.069192e-01  ...  5.978147e-10  7.398242e-08\nTotalCharges      5.749627e-01  1.524285e-06  ...  1.834568e-06  1.958368e-12\nChurn             1.000095e-03  1.517529e-01  ...  1.690637e-06  3.993541e-06\nContract          4.172909e-02  1.851923e-01  ...  1.353859e-05  8.714880e-07\nDependents        2.018980e-04  4.272720e-02  ...  6.534426e-07  1.092735e-12\nDeviceProtection  1.821192e-01  8.619380e-06  ...  4.627334e-05  1.818758e-14\nGender            6.145598e-08  1.445026e-07  ...  4.577077e-05  4.931367e-05\nInternetService   8.528444e-02  2.563737e-01  ...  3.075429e-05  2.417889e-06\nMultipleLines     4.279747e-02  2.981547e-03  ...  4.902979e-06  1.867618e-07\nOnlineBackup      1.224257e-01  4.230329e-06  ...  1.709518e-06  2.107805e-06\nOnlineSecurity    7.439183e-02  1.536858e-03  ...  1.064014e-04  1.212164e-06\nPaperlessBilling  2.630919e-03  5.840094e-02  ...  2.342487e-06  5.380497e-04\nPartner           2.062052e-02  9.395777e-03  ...  2.113838e-07  5.502509e-07\nPaymentMethod     4.179515e-02  1.453325e-01  ...  4.049852e-04  1.158845e-06\nPhoneService      2.085858e-06  1.482284e-04  ...  1.666081e-09  1.552041e-10\nSeniorCitizen     1.596509e-04  2.818686e-02  ...  2.887529e-07  1.610393e-05\nStreamingMovies   1.649421e-01  7.779385e-03  ...  3.674741e-07  9.811864e-10\nStreamingTV       1.598736e-01  8.112913e-03  ...  1.034660e-05  2.899077e-06\nTechSupport       1.125803e-01  7.815585e-04  ...  2.060583e-08  2.672637e-11\nTenure            2.758900e-01  2.995894e-02  ...  8.930918e-01  9.284358e-01\n\n[20 rows x 10 columns]\n```\n\n\n:::\n:::\n\n\n\n#### Contribuciones\n\nEn el siguiente apartado, podemos visualizar la contribución de cada una de las varaibles a las dimensiones.\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n(famdPy.column_contributions_)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ncomponent                0         1  ...         8             9\nvariable                              ...                        \nMonthlyCharges    0.014264  0.012331  ...  0.000003  3.000298e-05\nTotalCharges      0.020957  0.000047  ...  0.000149  1.543644e-07\nChurn             0.000874  0.014691  ...  0.000143  2.204343e-04\nContract          0.005646  0.016229  ...  0.000405  1.029748e-04\nDependents        0.000393  0.007795  ...  0.000089  1.153075e-07\nDeviceProtection  0.011795  0.000111  ...  0.000749  1.487605e-08\nGender            0.000007  0.000014  ...  0.000745  7.746111e-04\nInternetService   0.008071  0.019095  ...  0.000611  1.715214e-04\nMultipleLines     0.005718  0.002059  ...  0.000244  4.766988e-05\nOnlineBackup      0.009671  0.000078  ...  0.000144  1.601457e-04\nOnlineSecurity    0.007538  0.001478  ...  0.001136  1.214453e-04\nPaperlessBilling  0.001418  0.009114  ...  0.000169  2.558652e-03\nPartner           0.003969  0.003655  ...  0.000051  8.182395e-05\nPaymentMethod     0.005650  0.014377  ...  0.002217  1.187443e-04\nPhoneService      0.000040  0.000459  ...  0.000004  1.374205e-06\nSeniorCitizen     0.000349  0.006331  ...  0.000059  4.426556e-04\nStreamingMovies   0.011225  0.003326  ...  0.000067  3.455221e-06\nStreamingTV       0.011051  0.003397  ...  0.000354  1.878148e-04\nTechSupport       0.009274  0.001054  ...  0.000016  5.702562e-07\nTenure            0.014517  0.006527  ...  0.104116  1.062860e-01\n\n[20 rows x 10 columns]\n```\n\n\n:::\n:::\n\n\n\nLa siguiente figura muestra la correlación entre las variables, tanto cuantitativas como cualitativas, y las dimensiones principales, así como la contribución de las variables a las dimensiones 1 y 2.\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# Coordenadas de las variables (componentes 1 y 2)\ncoords = famdPy.column_coordinates_\n\n# Elegimos los dos primeros componentes\nx = coords[0]\ny = coords[1]\n\nplt.figure(figsize=(8, 8))\nplt.axhline(0, color='gray', lw=1)\nplt.axvline(0, color='gray', lw=1)\n\n# Dibujar solo puntos con etiquetas\nplt.scatter(x, y, color='white')\n\nfor i in range(len(coords)):\n    plt.text(x[i], y[i], coords.index[i], fontsize=9, color=\"red\" , ha='center', va='center')\n\nplt.title(\"Variables en el plano factorial (FAMD)\")\nplt.xlabel(\"Dim 1\")\nplt.ylabel(\"Dim 2\")\nplt.grid(True)\nplt.axis('equal')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(-0.0379131486918263, 0.7961761225283522, -0.025316678052831384, 0.531650239109459)\n```\n\n\n:::\n\n```{.python .cell-code}\nplt.show()\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/graficoVariables-py-1.png){width=768}\n:::\n:::\n\n\n\nA continuación vamos a visualizar las contribuciones de las variables en la primera dimensión.\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# Obtener coordenadas de las variables\ncoords = famdPy.column_coordinates_\n\n# Calcular la contribución (cos²) al eje 1\n# Es la coordenada al cuadrado de cada variable en ese eje\ncontrib = (coords[0] ** 2)\n\n# Normalizar en porcentaje\ncontrib_percent = 100 * contrib / contrib.sum()\n\n# Ordenar de mayor a menor\ncontrib_percent = contrib_percent.sort_values(ascending=False)\n\n# Calcular la media\nmean_contrib = 100 / len(contrib_percent)\n\n# Graficar\nplt.figure(figsize=(10, 6))\nsns.barplot(x=contrib_percent.values, y=contrib_percent.index, palette=\"Blues_d\")\nplt.axvline(mean_contrib, color='red', linestyle='--', label=f'Media = {mean_contrib:.2f}%')\nplt.xlabel('Contribución al componente 1 (%)')\nplt.title('Contribución de variables al eje 1 (FAMD)')\nplt.legend()\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/contribuciones1aDim-py-3.png){width=960}\n:::\n:::\n\n\n\nSeguidamente podemos ver las contribuciones de las variables en la 2a dimensión.\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# Obtener coordenadas de las variables\ncoords = famdPy.column_coordinates_\n\n# Calcular la contribución (cos²) al eje 1\n# Es la coordenada al cuadrado de cada variable en ese eje\ncontrib = (coords[1] ** 2)\n\n# Normalizar en porcentaje\ncontrib_percent = 100 * contrib / contrib.sum()\n\n# Ordenar de mayor a menor\ncontrib_percent = contrib_percent.sort_values(ascending=False)\n\n# Calcular la media\nmean_contrib = 100 / len(contrib_percent)\n\n# Graficar\nplt.figure(figsize=(10, 6))\nsns.barplot(x=contrib_percent.values, y=contrib_percent.index, palette=\"Blues_d\")\nplt.axvline(mean_contrib, color='red', linestyle='--', label=f'Media = {mean_contrib:.2f}%')\nplt.xlabel('Contribución al componente 2 (%)')\nplt.title('Contribución de variables al eje 2 (FAMD)')\nplt.legend()\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/contribuciones2aDim-py-5.png){width=960}\n:::\n:::\n\n\n\nLa línea discontinua roja en el gráfico anterior indica el valor promedio esperado, si las contribuciones fueran uniformes.\n\nDe los gráficos anteriormente expuestos se puede observar que:\n\n-   Las variables más contribuyentes a la primera dimensión són:\n\n    -   ...\n\n-   Las variables que más contribuyen a la segunda dimensión son:\n\n    -   ...\n:::\n\n### Variables cuantitativas\n\nPara extraer los resultados de las variables cuantitativas, se debe realizar el siguiente proceso:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(quanti.var <- get_famd_var(res.famd, \"quanti.var\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFAMD results for quantitative variables \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n\n\n:::\n:::\n\n\n\nA continuación vamos a visualizar el círculo unitario tal y como extraiamos de la aplicación del **ACP**. Para no superponer las etiquetas de las variables numéricas, vamos a utilizar el parámetro `repel = TRUE`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quanti.var\", repel = TRUE,\n              col.var = \"black\")\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/circuloUnitario-R-1.png){width=672}\n:::\n:::\n\n\n\nEl gráfico de variables (círculo unitario) muestra la relación entre las variables, la calidad de su representación, así como la correlación entre las variables y las dimensiones.\n\nLas variables cuantitativas más contribuyentes se pueden resaltar en el diagrama de dispersión mediante el argumento `col.var = \"contrib\"`. Esto produce un degradado de colores, que se puede personalizar mediante el argumento `gradient.cols`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quanti.var\", col.var = \"contrib\", gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/circulo Unitario Contribuciones-R-1.png){width=672}\n:::\n:::\n\n\n\nDel mismo modo, puede resaltar variables cuantitativas utilizando sus valores cos$^2$ que representan la calidad de la representación en el mapa factorial. Si una variable está bien representada por dos dimensiones, la suma del cos$^2$ se aproxima a uno. Para algunos de los elementos, es posible que se requieran más de 2 dimensiones para representar perfectamente los datos.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quanti.var\", col.var = \"cos2\", gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/circulo unitario calidad-R-1.png){width=672}\n:::\n:::\n\n\n### Variables cualitativas\n\nAl igual que las variables cuantitativas, los resultados de las variables cualitativas se pueden extraer de la siguiente manera:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(quali.var <- get_famd_var(res.famd, \"quali.var\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFAMD results for qualitative variable categories \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n\n\n:::\n:::\n\n\n\nPara visualizar las variables cualitativas, se ha de escribir el siguiente código:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nfviz_famd_var(res.famd, \"quali.var\", col.var = \"contrib\", gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"))\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/varsCualitativasContribucion-R-1.png){width=672}\n:::\n:::\n\n\n\nLa gráfica anterior muestra las categorías de las variables categóricas.\n\n## Individuos\n\nSi se desean hacer gráficos individuales se realiza lo siguiente.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(ind <- get_famd_ind(res.famd))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFAMD results for individuals \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n\n\n:::\n:::\n\n\n\nPara representar gráficamente a los individuos, utilizaremos la función `fviz_mfa_ind()` del paquete `factoextra`. Por defecto, los individuos están coloreados en azul. Sin embargo, al igual que las variables, también es posible colorear a los individuos por sus valores de cos2 y contribución:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_ind(res.famd, col.ind = \"cos2\", \n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), repel = TRUE)\n```\n:::\n\n\n\nLas categorias de las variables cualitativas se muestran en negro. Para poder eliminar dichas modalidades, utilizamos el parámetro `invisible = \"quali.var\"`.\n\nLos individuos con perfiles similares se encuentran cerca en el mapa factorial.\n\nEs posible colorear a los individuos utilizando cualquiera de las variables cualitativas en la tabla de datos inicial. Para ello, se utiliza el argumento habillage en la función `fviz_famd_ind()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_mfa_ind(res.famd, \n             habillage = \"Churn\", # color by groups \n             palette = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n             addEllipses = TRUE, ellipse.type = \"confidence\", \n             repel = TRUE # Avoid text overlapping\n             ) \n```\n:::\n\n\n\nSi lo que queremos es colorear los individuos usando múltiples variables categóricas al mismo tiempo, se deberá de utilizar la función `fviz_ellipses()` del paquete `factoextra` de la siguiente forma:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_ellipses(res.famd, c(\"Churn\", \"Gender\"), repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/multiples varCat en planoFactorial - R-1.png){width=672}\n:::\n:::\n\n\n\nTambién se puede identificar que variables categóricas queremos representar con el id de las variables:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_ellipses(res.famd, 1:2, geom = \"point\")\n```\n\n::: {.cell-output-display}\n![](FAMD_files/figure-html/multiples varCat en planoFactorial por id - R-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "FAMD_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}