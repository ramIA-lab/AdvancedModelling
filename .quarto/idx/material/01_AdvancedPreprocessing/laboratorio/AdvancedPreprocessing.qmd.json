{"title":"Advanced Preprocessing","markdown":{"yaml":{"title":"Advanced Preprocessing","author":"Dante Conti, Sergi Ramirez, (c) IDEAI","date":"`r Sys.Date()`","date-modified":"`r Sys.Date()`","toc":true,"number-sections":true,"format":{"html":{"theme":"cerulean"}},"editor":"visual"},"headingText":"Descripció del problema","containsRefs":false,"markdown":"\n\n\nAquest conjunt de dades sintètiques, està dissenyat per a simular dades de transaccions d'una plataforma de comerç electrònic amb el focus posat en la detecció de fraus. Conté una varietat de característiques que es troben comunament en les dades transaccionals, amb atributs addicionals dissenyats específicament.\n\n- ***\"ID de transacció\" :*** Un identificador únic per a cada transacció.\n\n- ***\"ID del client\" :*** Un identificador únic per a cada client.\n\n- ***\"Quantitat de transacció\" :*** La quantitat total de diners intercanviats en la transacció.\n\n- ***\"Data de transacció\" :*** La data i hora en què es va dur a terme la transacció.\n\n- ***\"Mètode de pagament\" :*** El mètode utilitzat per completar la transacció (p. ex., targeta de crèdit, PayPal, etc.).\n\n- ***\" Categoria del producte\" :*** La categoria del producte implicat en la transacció.\n\n- ***\"Quantitat\" :*** El nombre de productes involucrats en la transacció.\n\n- ***\"Edat del client\" :*** L'edat del client que realitza la transacció.\n\n- ***\"Situació del client\" :*** La ubicació geogràfica del client.\n\n- ***\"Device Used\" :*** El tipus de dispositiu utilitzat per a fer la transacció (p. ex., mòbil, escriptori).\n\n- ***\"adreça IP\" :*** L'adreça IP del dispositiu utilitzat per a la transacció.\n\n- ***\"Adreça d'enviament\" :*** L'adreça on s'ha enviat el producte.\n\n- ***\"Adreça de liquidació\" :*** L'adreça associada amb el mètode de pagament.\n\n- ***\"Is Fraudulent\" :*** Un indicador binari de si la transacció és fraudulenta (1 per fraudulent, 0 per legítim).\n\n- ***\"Dies de l'edat del compte\":*** L'edat del compte del client en dies en el moment de la transacció.\n\n- ***\"Hora de transacció\" :*** L'hora del dia en què es va produir la transacció.\n\n**Mètode de generació**\n\nLes dades són totalment sintètiques, generades utilitzant la biblioteca `Faker de Python` i la lògica personalitzada per simular patrons de transacció realistes i escenaris fraudulents. El conjunt de dades no es basa en individus o transaccions reals i es crea amb finalitats educatives i de recerca.\n\n**Font**: [Kaggle](https://www.kaggle.com/datasets/shriyashjagtap/fraudulent-e-commerce-transactions)\n\n```{r}\n#| label: carregar-dades\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\n## Ruta ón es troba les nostres dades\npath <- \"./\"\n\n## Nom del fitxer de les dades\nfitxer <- \"\"\n\n## Carreguem la base de dades\ndades <- read.csv(paste0(path, \"Fraudulent_E-Commerce_Transaction_Data.csv\"))\n```\n\n# Selecció de variables \n\nA continuació seleccionarem unes variables en concret per tal de poder seguir amb la pràctica. En altres apartats d'aquest script podràs veure diferents mètodes de selecció de variables multivariades. \n\n::: panel-tabset\n## R\n```{r}\n#| label: selecció-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(dplyr)\nlibrary(tidyr)\n\ndades <- dades %>% \n          select(-Transaction.ID, -Customer.ID, -IP.Address, -Shipping.Address, \n                 -Billing.Address) %>% \n          data.frame()\n```\n\n## Python\n```{python}\n#| echo: false\n#| warning: false\n#| message: false\n#| error: false\n```\n:::\n\nA continuació anem a realitzar un *preprocessing* bàsic per tal de poder iniciar la pràctica des d'una base de dades completament neta. \n\n# *Data Preprocessing*\n\nPrimer de tot, anem a processar el nom de les columnes, és per això que el que primer farem serà detectar si existeien caràcters especials en el nom de les columnes. Per realitzar aquesta operació utilitzarem el paquet `janitor`. \n\n::: panel-tabset\n## R\n```{r}\n#| label: preprocessing-dates\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(janitor)\n\ndades <- dades %>% \n          janitor::clean_names()\n\n# Visualitzem el nom de les columnes\ncolnames(dades)\n```\n\nCóm podem comprovar s'han substituit tots els punts que separaven els noms de les columnes per una `\"_\"`. En cas que hi haguessin accents els hagués substitut per la seva lletra sense accent corresponent.\n\nSeguidament, eliminem totes aquelles columnes y files que continguin tot NA's. Això es degut per problemes en la lectura més que problemes de les dades. \n\n```{r}\n#| label: elimina-tot-NAs\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(janitor)\n\n# Visualitzem les dimensions de la nostra base de dades abans d'eliminar\ncat(\"Tenim \", nrow(dades), \" files i \", ncol(dades), \" columnes\\n\")\n\ndades <- dades %>% \n          janitor::remove_empty(which = c(\"rows\", \"cols\"))\n\ncat(\"Després de l'eliminació ens queda \", nrow(dades), \" files i \", ncol(dades), \n\" columnes\\n\")\n```\nCom hem pogut comprovar, no hem tingut cap fila ni cap columna que contingui tot NA's. Per tant podem seguir amb el següent pas, detectar possibles errors d'escriptura de les variables categóriques. \n\n```{r}\n#| label: recoding\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nclases <- sapply(dades, class)\nvarCat <- names(clases)[which(clases %in% c(\"character\", \"factor\"))]\n\nfor (vC in varCat) {\n  dades %>% \n    count(get(vC)) %>% print()\n}\n\n```\n\nCóm podem veure, tenim 2 variables categóriques que tenen moltes modalitats, a la llarga ens podrien donar problemes. La decisió *educativa* que prenem per seguir endavant és eliminar aquestes variables. \n\n```{r}\n#| label: eliminar-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n          select(-transaction_date, -customer_location)\n```\n\nAnem a recodificar la variable `is_fraudulent` amb els valors corresponents.\n\n```{r}\n#| label: recodificar-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n         mutate(is_fraudulent = case_when(\n                is_fraudulent == 0 ~ \"no\", \n                is_fraudulent == 1 ~ \"si\"\n         ))\n```\n\n\n## Python\n\n```{python}\n#| echo: false\n#| warning: false\n#| message: false\n#| error: false\n```\n:::\n\n# Metadata files \n\nUna de les parts més importants per tal d'iniciar un projecte és el de tenir un fitxer de metadata capaç d'explicar-nos quines són les variables a estudiar i com es comporten aquestes dades tant a nivell de distribució com en tractament de NA's en cada variable. \n\n::: panel-tabset\n## R\n\nPrimer de tot anem a incorporar les etiquetes (definicions de cada variable)\n\n```{r}\n#| label: definicions-variables\n#| echo: false\n#| eval: false\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n        # assigna etiquetes a les noves variables derivades que no existien al \n        # llibre de codis\n        labelled::set_variable_labels(\n           Transaction.Amount = \"La quantitat total de diners intercanviats en \n                                 la transacció\",\n           Transaction.Date = \"La data i hora en què es va dur a terme la \n                              transacció.\",\n           Payment.Method = \"El mètode utilitzat per completar la transacció \n                            (p. ex., targeta de crèdit, PayPal, etc.).\",\n           Product.Category = \"La categoria del producte implicat en la \n                              transacció.\", \n           Quantity = \"El nombre de productes involucrats en la transacció.\",     \n           Customer.Age = \"L'edat del client que realitza la transacció.\",\n           Customer.Location = \"La ubicació geogràfica del client.\",\n           Device.Used = \"El tipus de dispositiu utilitzat per a fer la \n                          transacció (p. ex., mòbil, escriptori).\",\n           Is.Fraudulent = \"Un indicador binari de si la transacció és \n                            fraudulenta (1 per fraudulent, 0 per legítim)\",\n           Account.Age.Days = \"L'edat del compte del client en dies en el moment \n                              de la transacció\",\n           Transaction.Hour = \"L'hora del dia en què es va produir la \n                              transacció\")\n```\n\n## Python\n```{python}\n\n```\n:::\n\n\n\n","srcMarkdownNoYaml":"\n\n# Descripció del problema\n\nAquest conjunt de dades sintètiques, està dissenyat per a simular dades de transaccions d'una plataforma de comerç electrònic amb el focus posat en la detecció de fraus. Conté una varietat de característiques que es troben comunament en les dades transaccionals, amb atributs addicionals dissenyats específicament.\n\n- ***\"ID de transacció\" :*** Un identificador únic per a cada transacció.\n\n- ***\"ID del client\" :*** Un identificador únic per a cada client.\n\n- ***\"Quantitat de transacció\" :*** La quantitat total de diners intercanviats en la transacció.\n\n- ***\"Data de transacció\" :*** La data i hora en què es va dur a terme la transacció.\n\n- ***\"Mètode de pagament\" :*** El mètode utilitzat per completar la transacció (p. ex., targeta de crèdit, PayPal, etc.).\n\n- ***\" Categoria del producte\" :*** La categoria del producte implicat en la transacció.\n\n- ***\"Quantitat\" :*** El nombre de productes involucrats en la transacció.\n\n- ***\"Edat del client\" :*** L'edat del client que realitza la transacció.\n\n- ***\"Situació del client\" :*** La ubicació geogràfica del client.\n\n- ***\"Device Used\" :*** El tipus de dispositiu utilitzat per a fer la transacció (p. ex., mòbil, escriptori).\n\n- ***\"adreça IP\" :*** L'adreça IP del dispositiu utilitzat per a la transacció.\n\n- ***\"Adreça d'enviament\" :*** L'adreça on s'ha enviat el producte.\n\n- ***\"Adreça de liquidació\" :*** L'adreça associada amb el mètode de pagament.\n\n- ***\"Is Fraudulent\" :*** Un indicador binari de si la transacció és fraudulenta (1 per fraudulent, 0 per legítim).\n\n- ***\"Dies de l'edat del compte\":*** L'edat del compte del client en dies en el moment de la transacció.\n\n- ***\"Hora de transacció\" :*** L'hora del dia en què es va produir la transacció.\n\n**Mètode de generació**\n\nLes dades són totalment sintètiques, generades utilitzant la biblioteca `Faker de Python` i la lògica personalitzada per simular patrons de transacció realistes i escenaris fraudulents. El conjunt de dades no es basa en individus o transaccions reals i es crea amb finalitats educatives i de recerca.\n\n**Font**: [Kaggle](https://www.kaggle.com/datasets/shriyashjagtap/fraudulent-e-commerce-transactions)\n\n```{r}\n#| label: carregar-dades\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\n## Ruta ón es troba les nostres dades\npath <- \"./\"\n\n## Nom del fitxer de les dades\nfitxer <- \"\"\n\n## Carreguem la base de dades\ndades <- read.csv(paste0(path, \"Fraudulent_E-Commerce_Transaction_Data.csv\"))\n```\n\n# Selecció de variables \n\nA continuació seleccionarem unes variables en concret per tal de poder seguir amb la pràctica. En altres apartats d'aquest script podràs veure diferents mètodes de selecció de variables multivariades. \n\n::: panel-tabset\n## R\n```{r}\n#| label: selecció-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(dplyr)\nlibrary(tidyr)\n\ndades <- dades %>% \n          select(-Transaction.ID, -Customer.ID, -IP.Address, -Shipping.Address, \n                 -Billing.Address) %>% \n          data.frame()\n```\n\n## Python\n```{python}\n#| echo: false\n#| warning: false\n#| message: false\n#| error: false\n```\n:::\n\nA continuació anem a realitzar un *preprocessing* bàsic per tal de poder iniciar la pràctica des d'una base de dades completament neta. \n\n# *Data Preprocessing*\n\nPrimer de tot, anem a processar el nom de les columnes, és per això que el que primer farem serà detectar si existeien caràcters especials en el nom de les columnes. Per realitzar aquesta operació utilitzarem el paquet `janitor`. \n\n::: panel-tabset\n## R\n```{r}\n#| label: preprocessing-dates\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(janitor)\n\ndades <- dades %>% \n          janitor::clean_names()\n\n# Visualitzem el nom de les columnes\ncolnames(dades)\n```\n\nCóm podem comprovar s'han substituit tots els punts que separaven els noms de les columnes per una `\"_\"`. En cas que hi haguessin accents els hagués substitut per la seva lletra sense accent corresponent.\n\nSeguidament, eliminem totes aquelles columnes y files que continguin tot NA's. Això es degut per problemes en la lectura més que problemes de les dades. \n\n```{r}\n#| label: elimina-tot-NAs\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nlibrary(janitor)\n\n# Visualitzem les dimensions de la nostra base de dades abans d'eliminar\ncat(\"Tenim \", nrow(dades), \" files i \", ncol(dades), \" columnes\\n\")\n\ndades <- dades %>% \n          janitor::remove_empty(which = c(\"rows\", \"cols\"))\n\ncat(\"Després de l'eliminació ens queda \", nrow(dades), \" files i \", ncol(dades), \n\" columnes\\n\")\n```\nCom hem pogut comprovar, no hem tingut cap fila ni cap columna que contingui tot NA's. Per tant podem seguir amb el següent pas, detectar possibles errors d'escriptura de les variables categóriques. \n\n```{r}\n#| label: recoding\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\nclases <- sapply(dades, class)\nvarCat <- names(clases)[which(clases %in% c(\"character\", \"factor\"))]\n\nfor (vC in varCat) {\n  dades %>% \n    count(get(vC)) %>% print()\n}\n\n```\n\nCóm podem veure, tenim 2 variables categóriques que tenen moltes modalitats, a la llarga ens podrien donar problemes. La decisió *educativa* que prenem per seguir endavant és eliminar aquestes variables. \n\n```{r}\n#| label: eliminar-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n          select(-transaction_date, -customer_location)\n```\n\nAnem a recodificar la variable `is_fraudulent` amb els valors corresponents.\n\n```{r}\n#| label: recodificar-variables\n#| echo: true\n#| eval: true\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n         mutate(is_fraudulent = case_when(\n                is_fraudulent == 0 ~ \"no\", \n                is_fraudulent == 1 ~ \"si\"\n         ))\n```\n\n\n## Python\n\n```{python}\n#| echo: false\n#| warning: false\n#| message: false\n#| error: false\n```\n:::\n\n# Metadata files \n\nUna de les parts més importants per tal d'iniciar un projecte és el de tenir un fitxer de metadata capaç d'explicar-nos quines són les variables a estudiar i com es comporten aquestes dades tant a nivell de distribució com en tractament de NA's en cada variable. \n\n::: panel-tabset\n## R\n\nPrimer de tot anem a incorporar les etiquetes (definicions de cada variable)\n\n```{r}\n#| label: definicions-variables\n#| echo: false\n#| eval: false\n#| warning: false\n#| message: false\n#| error: false\n\ndades <- dades %>% \n        # assigna etiquetes a les noves variables derivades que no existien al \n        # llibre de codis\n        labelled::set_variable_labels(\n           Transaction.Amount = \"La quantitat total de diners intercanviats en \n                                 la transacció\",\n           Transaction.Date = \"La data i hora en què es va dur a terme la \n                              transacció.\",\n           Payment.Method = \"El mètode utilitzat per completar la transacció \n                            (p. ex., targeta de crèdit, PayPal, etc.).\",\n           Product.Category = \"La categoria del producte implicat en la \n                              transacció.\", \n           Quantity = \"El nombre de productes involucrats en la transacció.\",     \n           Customer.Age = \"L'edat del client que realitza la transacció.\",\n           Customer.Location = \"La ubicació geogràfica del client.\",\n           Device.Used = \"El tipus de dispositiu utilitzat per a fer la \n                          transacció (p. ex., mòbil, escriptori).\",\n           Is.Fraudulent = \"Un indicador binari de si la transacció és \n                            fraudulenta (1 per fraudulent, 0 per legítim)\",\n           Account.Age.Days = \"L'edat del compte del client en dies en el moment \n                              de la transacció\",\n           Transaction.Hour = \"L'hora del dia en què es va produir la \n                              transacció\")\n```\n\n## Python\n```{python}\n\n```\n:::\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"number-sections":true,"output-file":"AdvancedPreprocessing.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.37","theme":"cerulean","title":"Advanced Preprocessing","author":"Dante Conti, Sergi Ramirez, (c) IDEAI","date":"`r Sys.Date()`","date-modified":"`r Sys.Date()`","editor":"visual"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}